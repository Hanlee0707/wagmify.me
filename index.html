<html>

<script>
  // Gateways aren't providing the correct cache headers most of
  // the time, so we use service worker to cache the homepage
  // manually.
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .catch(function(err) {
        console.log('Service Worker registration failed, ignoring');
      });
  }

  function solScanURL(path, env) {
    if (env === 'devnet' || env === 'testnet') {
      return `https://solscan.io/${path}?cluster=${env}`
    }
    return `https://solscan.io/${path}`;
  }

  function etherscanURL(path, env) {
    const testNets = ['ropsten', 'kovan', 'goerli', 'rinkeby'];
    if (env && testNets.includes(env)) {
      return `https://${env}.etherscan.io/${path}`;
    }
    return `https://etherscan.io/${path}`;
  }

  function redirectTo(url) {
    window.location = url
  }

  // Top 100 CoinGecko coins. Hardcoded to provide fast lookups.
  const coingeckoSymbolToID = {
    'btc': 'bitcoin',
    'etc': 'ethereum',
    'bnb': 'binance-coin',
    'usdt': 'tether',
    'sol': 'solana',
    'ada': 'cardano',
    'usdc': 'usd-coin',
    'dot': 'polkadot',
    'doge': 'dogecoin',
    'luna': 'terra-luna',
    'terra': 'terra-luna',
    'avax': 'avalanche',
    'shib': 'shiba-inu',
    'cro': 'crypto-com-coin',
    'wbtc': 'wrapped-bitcoin',
    'matic': 'polygon',
    'ltc': 'litecoin',
    'busd': 'binance-usd',
    'algo': 'algorand',
    'link': 'chainlink',
    'bch': 'bitcoin-cash',
    'uni': 'uniswap',
    'axs': 'axie-infinity',
    'xlm': 'stellar',
    'atom': 'cosmos',
    'vet': 'vechain',
    'ust': 'terra-usd',
    'icp': 'internet-computer',
    'ceth': 'compound-ether',
    'egld': 'elrond',
    'fil': 'filecoin',
    'trx': 'tron',
    'ftt': 'ftx-token',
    'steth': 'lido-staked-ether',
    'theta': 'theta-network',
    'hbar': 'hedera',
    'etc': 'ethereum-classic',
    'sand': 'the-sandbox',
    'mana': 'decentraland',
    'ftm': 'fantom',
    'cdai': 'compound-dai',
    'grt': 'the-graph',
    'xtz': 'tezos',
    'xmr': 'monero',
    'miota': 'iota',
    'xrd': 'radix',
    'hnt': 'helium',
    'ohm': 'olympus',
    'klay': 'klaytn',
    'mim': 'magic-internet-money',
    'leo': 'leo-token',
    'cake': 'pancakeswap',
    'enj': 'enjin-coin',
    'rune': 'thorchain',
    'one': 'harmony',
    'xec': 'ecash',
    'ar': 'arweave',
    'bsv': 'bitcoin-sv',
    'stx': 'stacks',
    'zec': 'zcash',
    'mkr': 'maker',
    'kda': 'kadena',
    'qnt': 'quant',
    'hbtc': 'huobi-btc',
    'chz': 'chiliz',
    'bat': 'basic-attention-token',
    'btt': 'bittorrent',
    'hot': 'holo',
    'kcs': 'kucoin-shares',
    'bcha': 'bitcoin-cash-abc',
    'tfuel': 'theta-fuel',
    'crv': 'curve-dao-token',
    'cel': 'celsius-network-token',
    'comp': 'compound',
    'ln': 'link',
    'time': 'wonderland',
    'msol': 'marinade-staked-sol',
    'exrd': 'e-radix',
    'omi': 'ecomi',
    'ht': 'huobi-token',
    'xem': 'nem',
    'iotx': 'iotex',
  }

  const params = new URLSearchParams(window.location.search)
  const queryParam = params.get("q")
  const query = queryParam.split(" ")
  if (!query) {
    window.location = "https://www.google.com"
  }
  const commandName = query[0]
  switch (commandName) {
    case "commands":
    case "help":
      break;

    case "p":
    case "price":
    case "coin": {
      let name = query[1]
      if (!name) {
        redirectTo("https://www.coingecko.com")
        break
      }

      if (name.startsWith('$')) {
        name = name.substring(1);
      }
      const link = coingeckoSymbolToID[name.toLowerCase()];
      if (link) {
        name = link;
      }
      redirectTo(`https://www.coingecko.com/en/coins/${name}`)
      break
    }

    case "tx": {
      const hash = query[1]
      const env = query[2]
      if (hash.startsWith("0x")) {
        redirectTo(etherscanURL(`tx/${hash}`, env))
      } else {
        redirectTo(solScanURL(`tx/${hash}`, env))
      }
      break;
    }

    case "w":
    case "wallet": {
      const hash = query[1]
      const env = query[2]
      if (hash.startsWith("0x") || hash.includes(".eth")) {
        redirectTo(etherscanURL(`address/${hash}`, env))
      } else {
        redirectTo(solScanURL(`account/${hash}`, env))
      }
      break;
    }

    case "dune": {
      const q = query.slice(1).join(' ')
      redirectTo(`https://dune.xyz/browse/dashboards?q=${encodeURIComponent(q)}`)
      break;
    }

    default: {
      if (query.length === 1 && query[0].endsWith('.eth')) {
        redirectTo(`https://etherscan.io/address/${commandName}`)
      } else {
        redirectTo(`http://www.google.com/search?q=${encodeURIComponent(queryParam)}`)
      }
    }
  }
</script>
<style>
  code {
    background-color: gainsboro;
  }

  ol {
    line-height: 22px;
  }
</style>

<body>
  <h1>Wagmify Commands</h1>
  <table>
    <tr>
      <td style="min-width:150px;"><b>Command</b></td>
      <td style="min-width:250px;"><b>Example</b></td>
      <td><b>Description</b></td>
    </tr>
    <tr>
      <td>help, commands</td>
      <td>commands</td>
      <td>Lists available commands.</td>
    </tr>
    <tr>
      <td>p, price</td>
      <td>p olympus</td>
      <td>Opens CoinGeiko dashboard for the spelled out coin.</td>
    </tr>
    <tr>
      <td>tx</td>
      <td>tx 0x000.. or tx 1123123 for SOL</td>
      <td>Opens Etherscan or Solscan depending on the hash type.</td>
    </tr>
    <tr>
      <td>w, wallet</td>
      <td>w kunalm.eth</td>
      <td>Opens the walllet based on the hash or the ENS name.</td>
    </tr>
  </table>

  <h4>Getting Started</h4>
  <ol>
    <li>Open Chrome and click the three dots. Click <code>Settings</code> and scroll down to
      <code>Search engines</code>.</li>
    <li>Click <code>Manage search engines</code>.</li>
    <li>Add a new search engine with the URL <a href="https://wagmify.me/?q=%s">https://wagmify.me/?q=%s</a>. Set both
      name and keyword to wagmify.</li>
    <li>Click on the tripple dot and make this the default search engine.</li>
  </ol>

  <a href="https://github.com/TritonLabs/wagmify.me">Source</a>
</body>

</html>